C51 COMPILER V9.60.0.0   MASTERCONTROL                                                     05/19/2020 12:05:04 PAGE 1   


C51 COMPILER V9.60.0.0, COMPILATION OF MODULE MASTERCONTROL
OBJECT MODULE PLACED IN MasterControl.obj
COMPILER INVOKED BY: F:\keil c51\C51\BIN\C51.EXE procedure\MasterControl.c LARGE OPTIMIZE(8,SPEED) BROWSE DEBUG OBJECTEX
                    -TEND PRINT(.\Listings\MasterControl.lst) TABS(2) OBJECT(MasterControl.obj)

line level    source

   1          #include "MasterControl.h"
   2          
   3          
   4          
   5          
   6          /****************************RLED1灯控******************************************************/ 
   7          void MasterControl()
   8          {
   9   1      
  10   1        
  11   1      /****************************RLED1灯控******************************************************/         
  12   1              if(MasterDataBuff[Reled1]==0x01)
  13   1              {
  14   2                RLED1=ON;  //亮
  15   2              }
  16   1              else if(MasterDataBuff[Reled1]==0x00)
  17   1              {
  18   2                RLED1=OFF; //灭
  19   2              }
  20   1              else
  21   1              {
  22   2                RLED1=RLED1;//保持原来的状态
  23   2              }
  24   1              
  25   1      /*****************************RLED3灯控*****************************************************/       
  26   1              if(MasterDataBuff[Reled3]==0x01)
  27   1              {
  28   2                RLED3=ON;//亮
  29   2              }
  30   1              else if(MasterDataBuff[Reled3]==0x00)
  31   1              {
  32   2                RLED3=OFF;//灭
  33   2              }
  34   1              else
  35   1              {
  36   2                RLED3=RLED3;//保持原来的状态
  37   2              }
  38   1      /*****************************RLED5灯控*****************************************************/
  39   1            if(MasterDataBuff[Reled5]==0x01)
  40   1              {
  41   2                RLED5=ON;
  42   2              }
  43   1              else if(MasterDataBuff[Reled5]==0x00)
  44   1              {
  45   2                RLED5=OFF;
  46   2              }
  47   1              else
  48   1              {
  49   2                RLED5=RLED5;//保持原来的状态
  50   2              }       
  51   1      /**********************************************************************************/
  52   1            // RLED1=(RX1_Buffer[7]==0x01)?ON:OFF;
  53   1             //RLED3=(RX1_Buffer[8]==0x01)?ON:OFF;//红灯控制
  54   1            // RLED5=(RX1_Buffer[9]==0x01)?ON:OFF;
C51 COMPILER V9.60.0.0   MASTERCONTROL                                                     05/19/2020 12:05:04 PAGE 2   

  55   1      /*****************************GLED1灯控*****************************************************/         
  56   1              if(MasterDataBuff[Grled1]==0x01)
  57   1              {
  58   2                GLED1=ON; //亮
  59   2              }
  60   1              else if(MasterDataBuff[Grled1]==0x00)
  61   1              {
  62   2                GLED1=OFF;
  63   2              }
  64   1              else
  65   1              {
  66   2                GLED1=GLED1;
  67   2              }
  68   1              
  69   1      /*****************************GLED3灯控*****************************************************/       
  70   1              if(MasterDataBuff[Grled3]==0x01)
  71   1              {
  72   2                GLED3=ON; //亮
  73   2              }
  74   1              else if(MasterDataBuff[Grled3]==0x00)
  75   1              {
  76   2                GLED3=OFF;
  77   2              }
  78   1              else
  79   1              {
  80   2                GLED3=GLED3;//保持原来的状态
  81   2              }
  82   1      /*******************************GLED5灯控***************************************************/
  83   1            if(MasterDataBuff[Grled5]==0x01)
  84   1              {
  85   2                GLED5=ON;  //亮
  86   2              }
  87   1              else if(MasterDataBuff[Grled5]==0x00)
  88   1              {
  89   2                GLED5=OFF;
  90   2              }
  91   1              else
  92   1              {
  93   2                GLED5=GLED5;//保持原来的状态
  94   2              }       
  95   1      /**********************************************************************************/
  96   1      //       GLED1=(RX1_Buffer[10]==0x01)?ON:OFF;
  97   1      //       GLED3=(RX1_Buffer[11]==0x01)?ON:OFF;//绿灯控制
  98   1      //       GLED5=(RX1_Buffer[12]==0x01)?ON:OFF;
  99   1      /**********************************************************************************/          
 100   1              if(MasterDataBuff[CupOne]==0x01)
 101   1              {
 102   2                Cup1=1;//传感器杯子有
 103   2              }
 104   1              else if(MasterDataBuff[CupOne]==0x00)
 105   1              {
 106   2                Cup1=0;//传感器杯子无
 107   2              }
 108   1      //        else
 109   1      //        {
 110   1      //          Cup1=Cup1;//保持原来的状态
 111   1      //        }
 112   1      //        
 113   1      /**********************************************************************************/        
 114   1              if(MasterDataBuff[CupTwo]==0x01)
 115   1              {
 116   2                Cup3=1;
C51 COMPILER V9.60.0.0   MASTERCONTROL                                                     05/19/2020 12:05:04 PAGE 3   

 117   2              }
 118   1              else if(MasterDataBuff[CupTwo]==0x00)
 119   1              {
 120   2                Cup3=0;
 121   2              }
 122   1      //        else
 123   1      //        {
 124   1      //          Cup3=Cup3;//保持原来的状态
 125   1      //        }
 126   1      /**********************************************************************************/
 127   1            if(MasterDataBuff[CupThree]==0x01)
 128   1              {
 129   2                Cup5=1;
 130   2              }
 131   1              else if(MasterDataBuff[CupThree]==0x00)
 132   1              {
 133   2                Cup5=0;
 134   2              }
 135   1      //        else
 136   1      //        {
 137   1      //          Cup5=Cup5;//保持原来的状态
 138   1      //        }       
 139   1      /**********************************************************************************/       
 140   1      //       Cup1=(RX1_Buffer[13]==0x01)?1:0;
 141   1      //       Cup3=(RX1_Buffer[14]==0x01)?1:0;//杯子有效性1：有效；0：无效
 142   1      //       Cup5=(RX1_Buffer[15]==0x01)?
 143   1      /**********************************************************************************/          
 144   1              if(MasterDataBuff[Water1]==0x01)
 145   1              {
 146   2                Water1Sensor=1;//控制有水流传感器工作
 147   2              }
 148   1              else if(MasterDataBuff[Water1]==0x00)
 149   1              {
 150   2                Water1Sensor=0;//控制无水流传感器停止
 151   2              }
 152   1      //        else
 153   1      //        {
 154   1      //          Water1Sensor=Water1Sensor;//保持原来的状态
 155   1      //        }
 156   1      //        
 157   1      /**********************************************************************************/        
 158   1              if(MasterDataBuff[Water3]==0x01)
 159   1              {
 160   2                Water3Sensor=1;
 161   2              }
 162   1              else if(MasterDataBuff[Water3]==0x00)
 163   1              {
 164   2                Water3Sensor=0;
 165   2              }
 166   1      //        else
 167   1      //        {
 168   1      //          Water3Sensor=Water3Sensor;//保持原来的状态
 169   1      //        }
 170   1      /**********************************************************************************/
 171   1            if(MasterDataBuff[Water5]==0x01)
 172   1              {
 173   2                Water5Sensor=1;
 174   2              }
 175   1              else if(MasterDataBuff[Water5]==0x00)
 176   1              {
 177   2                Water5Sensor=0;
 178   2              }
C51 COMPILER V9.60.0.0   MASTERCONTROL                                                     05/19/2020 12:05:04 PAGE 4   

 179   1      //        else   //这里有个问题 若加此语句Cup就会保持杯子拿走那的电平 导致一处于循环中，此语句还未带传感器是这
             -样
 180   1      //        {
 181   1      //          Water5Sensor=Water5Sensor;//保持原来的状态
 182   1      //        }       
 183   1      /**********************************************************************************/          
 184   1      //       Water1Sensor=(RX1_Buffer[16]==0x01)?1:0;
 185   1      //       Water3Sensor=(RX1_Buffer[17]==0x01)?1:0;//传感器数据可以不用控制
 186   1      //       Water5Sensor=(RX1_Buffer[18]==0x01)?1:0;
 187   1      /**********************************************************************************/          
 188   1              if(MasterDataBuff[pum1]==0x01)
 189   1              {
 190   2                Pump1=1;//控制泵启动
 191   2              }
 192   1              else if(MasterDataBuff[pum1]==0x00)
 193   1              {
 194   2                Pump1=0;//控制泵关闭
 195   2              }
 196   1      //        else
 197   1      //        {
 198   1      //          Pump1=Pump1;//保持原来的状态
 199   1      //        }
 200   1      //        
 201   1      /**********************************************************************************/        
 202   1              if(MasterDataBuff[pum3]==0x01)
 203   1              {
 204   2                Pump3=1;
 205   2              }
 206   1              else if(MasterDataBuff[pum3]==0x00)
 207   1              {
 208   2                Pump3=0;
 209   2              }
 210   1      //        else
 211   1      //        {
 212   1      //          Pump3=Pump3;//保持原来的状态
 213   1      //        }
 214   1      /**********************************************************************************/
 215   1            if(MasterDataBuff[pum5]==0x01)
 216   1              {
 217   2                Pump5=1;
 218   2              }
 219   1              else if(MasterDataBuff[pum5]==0x00)
 220   1              {
 221   2                Pump5=0;
 222   2              }
 223   1      //        else
 224   1      //        {
 225   1      //          Pump5=Pump5;//保持原来的状态
 226   1      //        }       
 227   1      /**********************************************************************************/         
 228   1      //       Pump1=(RX1_Buffer[19]==0x01)?1:0;
 229   1      //       Pump3=(RX1_Buffer[20]==0x01)?1:0;//0：水泵关；1：水泵开
 230   1      //       Pump5=(RX1_Buffer[21]==0x01)?1:0;
 231   1      /**********************************************************************************/          
 232   1              if(MasterDataBuff[Valve1]==0x01)
 233   1              {
 234   2                EXValve1=1;//控制继电器空气阀打开
 235   2              }
 236   1              else if(MasterDataBuff[Valve1]==0x00)
 237   1              {
 238   2              EXValve1=0;//控制继电器空气阀关闭
 239   2              }
C51 COMPILER V9.60.0.0   MASTERCONTROL                                                     05/19/2020 12:05:04 PAGE 5   

 240   1              else
 241   1              {
 242   2                EXValve1=EXValve1;//控制继电器空气阀保持原来的状态
 243   2              }
 244   1              
 245   1      /**********************************************************************************/        
 246   1              if(MasterDataBuff[Valve3]==0x01)
 247   1              {
 248   2                EXValve3=1;
 249   2              }
 250   1              else if(MasterDataBuff[Valve3]==0x00)
 251   1              {
 252   2                EXValve3=0;
 253   2              }
 254   1              else
 255   1              {
 256   2                EXValve3=EXValve3;//保持原来的状态
 257   2              }
 258   1      /**********************************************************************************/
 259   1            if(MasterDataBuff[Valve5]==0x01)
 260   1              {
 261   2                EXValve5=1;
 262   2              }
 263   1              else if(MasterDataBuff[Valve5]==0x00)
 264   1              {
 265   2                EXValve5=0;
 266   2              }
 267   1              else
 268   1              {
 269   2                EXValve5=EXValve5;//保持原来的状态
 270   2              }       
 271   1      /**********************************************************************************/
 272   1      //       EXValve1=(RX1_Buffer[22]==0x01)?1:0;
 273   1      //       EXValve3=(RX1_Buffer[23]==0x01)?1:0;//空气阀控制，拍去多余气体
 274   1      //       EXValve5=(RX1_Buffer[24]==0x01)?1:0;
 275   1      /**********************************************************************************/
 276   1            if(MasterDataBuff[Sensor]==0x01)
 277   1              {
 278   2                CapSensor=1;//打开5V水流总开关
 279   2              }
 280   1              else if(MasterDataBuff[Sensor]==0x00)
 281   1              {
 282   2                CapSensor=0;//关闭5V水流总开关
 283   2              }
 284   1              else
 285   1              {
 286   2                CapSensor=CapSensor;//保持原来的状态
 287   2              }       
 288   1      /**********************************************************************************/       
 289   1      //       CapSensor=(RX1_Buffer[25]==0x01)?1:0;//控制水流5V电源
 290   1      /**********************************************************************************/
 291   1      //      if(RX1_Buffer[26]==0x00)
 292   1      //      Cup1Eff=0；
 293   1      //      else if（RX1_Buffer[26]==0x01）
 294   1      //      up1Eff=0；
 295   1      /**********************************************************************************/
 296   1            if(MasterDataBuff[Conf1]==0x01)
 297   1              {
 298   2                Cup1Eff=1;//有效杯子
 299   2              }
 300   1              else if(MasterDataBuff[Conf1]==0x00)
 301   1              {
C51 COMPILER V9.60.0.0   MASTERCONTROL                                                     05/19/2020 12:05:04 PAGE 6   

 302   2                Cup1Eff=0;//无效杯子
 303   2              }
 304   1      //        else
 305   1      //        {
 306   1      //          Cup1Eff=Cup1Eff;//保持原来的状态
 307   1      //        }       
 308   1      /**********************************************************************************/  
 309   1      //     Cup1Eff=(RX1_Buffer[25]==0x01)?1:0;//0x00: Cup1整个功能无效；0x01:整个功能有效；其他情况保持原来状态
 310   1      /**********************************************************************************/
 311   1            if(MasterDataBuff[Conf3]==0x01)
 312   1              {
 313   2                Cup3Eff=1;//有效杯子
 314   2              }
 315   1              else if(MasterDataBuff[Conf3]==0x00)
 316   1              {
 317   2                Cup3Eff=0;//无效杯子
 318   2              }
 319   1      //        else
 320   1      //        {
 321   1      //          Cup3Eff=Cup3Eff;//保持原来的状态
 322   1      //        }       
 323   1      /**********************************************************************************/
 324   1      //       Cup3Eff=(RX1_Buffer[26]==0x01)?1:0;//0x00: Cup3整个功能无效；0x01:整个功能有效；其他情况保持原来状态
 325   1      /**********************************************************************************/
 326   1            if(MasterDataBuff[Conf5]==0x01)
 327   1              {
 328   2                Cup5Eff=1;//有效杯子
 329   2              }
 330   1              else if(MasterDataBuff[Conf5]==0x00)
 331   1              {
 332   2                Cup5Eff=0;//无效杯子
 333   2              }
 334   1      //        else
 335   1      //        {
 336   1      //          Cup5Eff=Cup5Eff;//保持原来的状态
 337   1      //        }       
 338   1      /**********************************************************************************/
 339   1      //Cup5Eff=(RX1_Buffer[27]==0x01)?1:0;//0x00: Cup5整个功能无效；0x01:整个功能有效；其他情况保持原来状态
 340   1      
 341   1      /**********************************************************************************/
 342   1              
 343   1              
 344   1      /**********************************************************************************/
 345   1      //      if(RX1_Buffer[29]==0x01)
 346   1      //        {
 347   1      //          ChassisLockChassisLock=1;//锁开
 348   1      //        }
 349   1      //        else if(RX1_Buffer[29]==0x00)
 350   1      //        {
 351   1      //          CChassisLock=0;//锁闭
 352   1      //        }
 353   1      //        else
 354   1      //        {
 355   1      //          ChassisLock = ChassisLock;//保持原来的状态
 356   1      //        }       
 357   1      /**********************************************************************************/        
 358   1      
 359   1              //ChassisLock
 360   1      //          SlaveControl();
 361   1      //            for(i=0;i<=30;i++)
 362   1      //            {
 363   1      //              UART_Send_Byte(TX1_Buffer[i]);//打印各个传感器的状态
C51 COMPILER V9.60.0.0   MASTERCONTROL                                                     05/19/2020 12:05:04 PAGE 7   

 364   1      //            }
 365   1             
 366   1           }
 367          
 368                
 369            
 370             
 371          //}
 372          
 373          //}
 374          
 375          
 376          /**********************************************************************************/
 377          /**********************************************************************************/
 378          
 379          
 380          
 381          
 382          /**********************************************************************************/
 383          //名称：MasterControlRead()
 384          //功能：从控到主控数据包读剩余杯子次数
 385          //参数：帧头+包长+识别码+功能码(0x58数据流)+数据段+效验码+帧尾  
 386          //返回值：void
 387          //--------------------------------
 388          //作者：XiongXiaoping   
 389          //修改日期：2020/05/07
 390          //修改内容：
 391          //----------------------------
 392          /**********************************************************************************/
 393          //void MasterControlRead()
 394          //{
 395          //      u8 y;
 396          //      if(T0_100MS2)
 397          //      {
 398          //        T0_100MS2=0;
 399          //      //  SlaveControlEE();//调用tx发送buff
 400          //        SlaveControl();
 401          //            for(y=0;y<=11;y++)
 402          //            {
 403          //              UART_Send_Byte(TX1_Buffer[y]);  //打印剩余杯子次数
 404          //            }  
 405          //     }
 406          //}
 407          /**********************************************************************************/
 408          
 409          
 410          /**********************************************************************************/
 411          //名称：void MasterControlReadEE()
 412          //功能：从控到主控数据包读从控板状态
 413          //参数：帧头+包长+识别码+功能码(0x57数据流)+数据段+效验码+帧尾  
 414          //    :SlaveControlEE()：发送函数数据调用
 415          //返回值：void
 416          //--------------------------------
 417          //作者：XiongXiaoping   
 418          //修改日期：2020/05/07
 419          //修改内容：指令下发解析后数据上报
 420          //----------------------------
 421          /**********************************************************************************/
 422          //void MasterControlReadEE()
 423          //{
 424          //         u8 i;
 425          //         if(T0_100MS2)
C51 COMPILER V9.60.0.0   MASTERCONTROL                                                     05/19/2020 12:05:04 PAGE 8   

 426          //         {
 427          //        
 428          //            T0_100MS2=0;
 429          //           SlaveControl();//调用tx发送buff
 430          //            for(i=0;i<=30;i++)
 431          //            {
 432          //              UART_Send_Byte(TX1_Buffer[i]);//打印各个传感器的状态
 433          //            }    
 434          //         }
 435          // }
 436          
 437          /**********************************************************************************/


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    515    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
